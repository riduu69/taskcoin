<!DOCTYPE html>
<html>
<head>
  <title>TaskCoin Login</title>
</head>
<body>

<h2>TaskCoin Login</h2>

<input type="email" id="email" placeholder="Email"><br><br>
<input type="password" id="password" placeholder="Password"><br><br>

<button onclick="signup()">Sign Up</button>
<button onclick="login()">Login</button>
<br><br>
<button onclick="googleLogin()">Login with Google</button>

<p id="msg"></p>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyD5pHFDyLgn1Gd2h0MdGMfLv9VM_kQ3bsw",
    authDomain: "taskcoin-2be79.firebaseapp.com",
    projectId: "taskcoin-2be79",
    storageBucket: "taskcoin-2be79.appspot.com",
    messagingSenderId: "103144012500",
    appId: "1:103144012500:web:c6a01af9fac3af107b5941"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  window.signup = async () => {
    const email = email.value;
    const password = password.value;

    try {
      const userCred = await createUserWithEmailAndPassword(auth, email, password);
      const uid = userCred.user.uid;

      await setDoc(doc(db, "users", uid), {
        email: email,
        coins: 10,
        createdAt: new Date()
      });

      msg.innerText = "Signup successful! 10 coins added ðŸŽ‰";
    } catch (e) {
      msg.innerText = e.message;
    }
  };

  window.login = async () => {
    const email = email.value;
    const password = password.value;

    try {
      const userCred = await signInWithEmailAndPassword(auth, email, password);
      const uid = userCred.user.uid;

      const snap = await getDoc(doc(db, "users", uid));
      msg.innerText = "Login success! Coins: " + snap.data().coins;
    } catch (e) {
      msg.innerText = e.message;
    }
  };

  window.googleLogin = async () => {
    const provider = new GoogleAuthProvider();
    try {
      const userCred = await signInWithPopup(auth, provider);
      const uid = userCred.user.uid;

      const ref = doc(db, "users", uid);
      const snap = await getDoc(ref);

      if (!snap.exists()) {
        await setDoc(ref, {
          email: userCred.user.email,
          coins: 10,
          createdAt: new Date()
        });
      }

      msg.innerText = "Google login success! ðŸŽ‰";
    } catch (e) {
      msg.innerText = e.message;
    }
  };
</script>

</body>
</html>
